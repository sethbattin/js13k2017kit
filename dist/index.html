<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Game Zero ES6</title><style>
body{margin:0;overflow:hidden;background:#111;color:#ccc}#canvas{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%;image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:-o-crisp-edges;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor;cursor:none;margin:auto}
</style></head><body><canvas id="canvas"></canvas><script>
ENGINE={E:this,screen:0,page1:65536,page2:131072,page3:196608,page4:262144,page5:327680,page6:393216,page7:458752,colors:[4278190080,4281606178,4282132549,4281416038,4282078863,4280709599,4284915929,4288332782,4281791227,4283491737,4281384554,4285436983,4281297227,4280568658,4281941042,4285808447,4286734384,4292963931,4294941539,4293184863,4294761419,4294967295,4290227611,4287069828,4285164137,4283586137,4287251062,4281479852,4284700633,4290411479,4283078543,4281364362],brightness:[0,1,2,14,3,15,13,27,26,25,16,4,12,24,31,28,17,23,11,5,30,29,18,6,10,22,19,7,9,20,8,21],palDefault:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],pal:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],renderTarget:0,renderSource:65536,currentState:0,playSound:function(buffer,playbackRate,pan,loop){var source=audioCtx.createBufferSource(),gainNode=audioCtx.createGain(),panNode=audioCtx.createStereoPanner();return source.buffer=buffer,source.connect(panNode),panNode.connect(gainNode),gainNode.connect(audioCtx.destination),source.playbackRate.value=playbackRate,source.loop=loop,gainNode.gain.value=1,panNode.pan.value=pan,source.start(),{volume:gainNode,sound:source}},gfx:{clear:function(color){E.ram.fill(color,E.renderTarget,E.renderTarget+65536)},pset:function(x,y,color){y|=0,(x|=0)>-1&&256>x&&y>-1&&256>y&&(E.ram[E.renderTarget+(256*y+x)]=color)},line:function(x1,y1,x2,y2,color){var stepx,stepy,dy=(y2|=0)-(y1|=0),dx=(x2|=0)-(x1|=0);if(0>dy?(dy=-dy,stepy=-1):stepy=1,0>dx?(dx=-dx,stepx=-1):stepx=1,dy<<=1,dx<<=1,this.pset(x1,y1,color),dx>dy)for(var fraction=dy-(dx>>1);x1!=x2;)0>fraction||(y1+=stepy,fraction-=dx),x1+=stepx,fraction+=dy,this.pset(x1,y1,color);else for(fraction=dx-(dy>>1);y1!=y2;)0>fraction||(x1+=stepx,fraction-=dy),y1+=stepy,fraction+=dx,this.pset(x1,y1,color)},circle:function(xm,ym,r,color){var x=-r,y=0,err=2-2*r;do{this.pset(xm-x,ym+y,color),this.pset(xm-y,ym-x,color),this.pset(xm+x,ym-y,color),this.pset(xm+y,ym+x,color),(r=err)>y||(err+=2*++y+1),(r>x||err>y)&&(err+=2*++x+1)}while(0>x)},fillCircle:function(xm,ym,r,color){xm|=0,ym|=0,color|=0;var x=-(r|=0),y=0,err=2-2*r;do{this.line(xm-x,ym-y,xm+x,ym-y,color),this.line(xm-x,ym+y,xm+x,ym+y,color),(r=err)>y||(err+=2*++y+1),(r>x||err>y)&&(err+=2*++x+1)}while(0>x)},rect:function(x1,y1,x2,y2,color){x1|=0,x2|=0,y1|=0,y2|=0,this.line(x1,y1,x2,y1,color),this.line(x2,y1,x2,y2,color),this.line(x1,y2,x2,y2,color),this.line(x1,y1,x1,y2,color)},fillRect:function(x1,y1,x2,y2,color){x1|=0,x2|=0,y1|=0,y2|=0;var i=Math.abs(y2-y1);if(E.gfx.line(x1,y1,x2,y1,color),i>0)for(;--i;)E.gfx.line(x1,y1+i,x2,y1+i,color);E.gfx.line(x1,y2,x2,y2,color)},triangle:function(x1,y1,x2,y2,x3,y3,color){E.gfx.line(x1,y1,x2,y2,color),E.gfx.line(x2,y2,x3,y3,color),E.gfx.line(x3,y3,x1,y1,color)},fillTriangle:function(x1,y1,x2,y2,x3,y3,color){var x1=Math.round(16*x1),x2=Math.round(16*x2),x3=Math.round(16*x3),y1=Math.round(16*y1),dx12=x1-x2,dy12=(y2=Math.round(16*y2))-y1,dx23=x2-x3,dy23=(y3=Math.round(16*y3))-y2,dx31=x3-x1,dy31=y1-y3,minx=Math.max(Math.min(x1,x2,x3)+15>>4,0),maxx=Math.min(Math.max(x1,x2,x3)+15>>4,256),miny=Math.max(Math.min(y1,y2,y3)+15>>4,0),maxy=Math.min(Math.max(y1,y2,y3)+15>>4,256);minx&=-8,miny&=-8;var c1=-dy12*x1-dx12*y1,c2=-dy23*x2-dx23*y2,c3=-dy31*x3-dx31*y3;(dy12>0||0==dy12&&dx12>0)&&c1++,(dy23>0||0==dy23&&dx23>0)&&c2++,(dy31>0||0==dy31&&dx31>0)&&c3++,c1=c1-1>>4,c2=c2-1>>4,c3=c3-1>>4;var nmin1=0,nmax1=0,nmin2=0,nmax2=0,nmin3=0,nmax3=0;0>dx12?nmin1-=7*dx12:nmax1-=7*dx12,0>dy12?nmin1-=7*dy12:nmax1-=7*dy12,0>dx23?nmin2-=7*dx23:nmax2-=7*dx23,0>dy23?nmin2-=7*dy23:nmax2-=7*dy23,0>dx31?nmin3-=7*dx31:nmax3-=7*dx31,0>dy31?nmin3-=7*dy31:nmax3-=7*dy31;for(var y0=miny;maxy>y0;y0+=8)for(var x0=minx;maxx>x0;x0+=8){var cy1=c1+dx12*y0+dy12*x0,cy2=c2+dx23*y0+dy23*x0,cy3=c3+dx31*y0+dy31*x0;if(!(nmax1>cy1||nmax2>cy2||nmax3>cy3)){var offset=x0+256*y0;if(cy1<nmin1||cy2<nmin2||cy3<nmin3)for(iy=0;8>iy;iy++){for(var cx1=cy1,cx2=cy2,cx3=cy3,ix=0;8>ix;ix++)0>(cx1|cx2|cx3)||(E.ram[E.renderTarget+offset]=color),cx1+=dy12,cx2+=dy23,cx3+=dy31,offset++;cy1+=dx12,cy2+=dx23,cy3+=dx31,offset+=248}else for(var iy=0;8>iy;iy++){for(ix=0;8>ix;ix++,offset++)E.ram[E.renderTarget+offset]=color;offset+=248}}}},spr:function(sx=0,sy=0,sw=16,sh=16,x=0,y=0,flipx=!1,flipy=!1){for(var i=0;sh>i;i++)for(var j=0;sw>j;j++)255>y+i&&255>x+j&&y+i>-1&&x+j>-1&&(flipx&flipy?E.ram[E.renderSource+(256*(sy+(sh-i))+sx+(sw-j))]>0&&(E.ram[E.renderTarget+(256*(y+i)+x+j)]=E.pal[E.ram[E.renderSource+(256*(sy+(sh-i))+sx+(sw-j))]]):flipy&&!flipx?E.ram[E.renderSource+(256*(sy+(sh-i))+sx+j)]>0&&(E.ram[E.renderTarget+(256*(y+i)+x+j)]=E.ram[E.renderSource+(256*(sy+(sh-i))+sx+j)]):flipx&&!flipy?E.ram[E.renderSource+(256*(sy+i)+sx+(sw-j))]>0&&(E.ram[E.renderTarget+(256*(y+i)+x+j)]=E.ram[E.renderSource+(256*(sy+i)+sx+(sw-j))]):flipx||flipy||E.ram[E.renderSource+(256*(sy+i)+sx+j)]>0&&(E.ram[E.renderTarget+(256*(y+i)+x+j)]=E.pal[E.ram[E.renderSource+(256*(sy+i)+sx+j)]]))},sspr:function(sx=0,sy=0,sw=16,sh=16,x=0,y=0,dw=16,dh=16,flipx=!1,flipy=!1){for(var xratio=sw/dw,yratio=sh/dh,i=0;dh>i;i++)for(var j=0;dw>j;j++)px=j*xratio|0,py=i*yratio|0,255>y+i&&255>x+j&&y+i>-1&&x+j>-1&&E.ram[E.renderSource+(256*(sy+py)+sx+px)]>0&&(E.ram[E.renderTarget+(256*(y+i)+x+j)]=E.ram[E.renderSource+(256*(sy+py)+sx+px)])},checker:function(nRow,nCol,color){var w=256,h=256,x=0,y=0;nRow=nRow||8,w/=nCol=nCol||8,h/=nRow;for(var i=0;nRow>i;++i)for(var j=0,col=nCol/2;col>j;++j)x=2*j*w+(i%2?0:w),y=i*h,E.gfx.fillRect(x,y,x+w,y+h,color)}},UIObject:{intersects:function(obj,mouse){var xIntersect=mouse.x+5>obj.x&&mouse.x-5<obj.x+obj.width,yIntersect=mouse.y+5>obj.y&&mouse.y-5<obj.y+obj.height;return xIntersect&&yIntersect},updateStats:function(canvas){this.intersects(this,canvas.mouse)?(this.hovered=!0,canvas.mouse.clicked&&(this.clicked=!0)):this.hovered=!1,canvas.mouse.down||(this.clicked=!1)}},imagetoRam:function(image,address){let tempCanvas=document.createElement("canvas");tempCanvas.width=256,tempCanvas.height=256;let context=tempCanvas.getContext("2d");context.drawImage(image,0,0);var imageData=context.getImageData(0,0,256,256);let data=new Uint32Array(imageData.data.buffer);for(var i=0;i<data.length;i++)E.ram[address+i]=E.colors.indexOf(data[i])},screenCapture:function(canvas){var image=canvas.toDataURL("image/png");window.open(image)},memoryCapture:function(){console.log(E.ram)},canvasInit:function(){E.canvas=document.getElementById("canvas"),E.ctx=canvas.getContext("2d"),E.canvas.width=window.innerWidth,E.canvas.height=window.innerHeight,E.ctx.imageSmoothingEnabled=!1,E.ctx.mozImageSmoothingEnabled=!1,E.smallcanvas=document.createElement("canvas"),E.smallctx=E.smallcanvas.getContext("2d"),E.smallcanvas.width=256,E.smallcanvas.height=256,E.canvasHeight=E.smallcanvas.height,E.canvasWidth=E.smallcanvas.width,E.imageData=E.smallctx.getImageData(0,0,E.canvasWidth,E.canvasHeight),E.buf=new ArrayBuffer(E.imageData.data.length),E.buf8=new Uint8ClampedArray(E.buf),E.data=new Uint32Array(E.buf),E.ram=new Uint8ClampedArray(524288),E.renderTarget=E.screen},render:function(){for(var i=65536;i--;)E.data[i]=E.colors[E.pal[E.ram[i]]];E.imageData.data.set(E.buf8),E.smallctx.putImageData(E.imageData,0,0),E.compositeSize=window.innerWidth<window.innerHeight?window.innerWidth:window.innerHeight,E.compositeOrigin=(window.innerWidth-E.compositeSize)/2|0,E.ctx.imageSmoothingEnabled=!1,E.ctx.mozImageSmoothingEnabled=!1,E.ctx.drawImage(E.smallcanvas,0,0,255,255,E.compositeOrigin,0,E.compositeSize,E.compositeSize)},switchState:function(state){arguments.length>0?app.setState(E.states[state]):(E.currentState+=1,E.currentState>E.states.length-1&&(E.currentState=0),app.setState(E.states[E.currentState]))}};var E=ENGINE;Number.prototype.map=function(in_min,in_max,out_min,out_max){return(this-in_min)*(out_max-out_min)/(in_max-in_min)+out_min},E.assets={song:{rowLen:5513,endPattern:2,songData:[{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:1,osc2_oct:6,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:192,osc2_waveform:1,noise_fader:0,env_attack:137,env_sustain:2e3,env_release:4611,env_master:192,fx_filter:1,fx_freq:982,fx_resonance:89,fx_delay_time:6,fx_delay_amt:25,fx_pan_freq:6,fx_pan_amt:77,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:69,lfo_waveform:0,p:[1],c:[{n:[135,0,0,0,147,0,0,145,0,0,147,0,0,142,0,0,135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]}],songLen:9}};var sonantx={},WAVE_SPS=44100,WAVE_CHAN=2,MAX_TIME=33,audioCtx=null;function osc_sin(value){return Math.sin(6.283184*value)}function osc_square(value){return 0>osc_sin(value)?-1:1}function osc_saw(value){return value%1-.5}function osc_tri(value){var v2=value%1*4;return 2>v2?v2-1:3-v2}var oscillators=[osc_sin,osc_square,osc_saw,osc_tri];function getnotefreq(n){return.00390625*Math.pow(1.059463094,n-128)}function genBuffer(waveSize,callBack){setTimeout(function(){var buf=new Uint8Array(waveSize*WAVE_CHAN*2),b=buf.length-2,iterate=function(){for(var begin=new Date,count=0;b>=0;)if(buf[b]=0,buf[b+1]=128,b-=2,(count+=1)%1e3==0&&new Date-begin>MAX_TIME)return void setTimeout(iterate,0);setTimeout(function(){callBack(buf)},0)};setTimeout(iterate,0)},0)}function applyDelay(chnBuf,waveSamples,instr,rowLen,callBack){var p1=instr.fx_delay_time*rowLen>>1,t1=instr.fx_delay_amt/255,n1=0,iterate=function(){for(var beginning=new Date,count=0;waveSamples-p1>n1;){var b1=4*n1,l=4*(n1+p1),x1=chnBuf[l]+(chnBuf[l+1]<<8)+(chnBuf[b1+2]+(chnBuf[b1+3]<<8)-32768)*t1;if(chnBuf[l]=255&x1,chnBuf[l+1]=x1>>8&255,x1=chnBuf[l+2]+(chnBuf[l+3]<<8)+(chnBuf[b1]+(chnBuf[b1+1]<<8)-32768)*t1,chnBuf[l+2]=255&x1,chnBuf[l+3]=x1>>8&255,++n1,(count+=1)%1e3==0&&new Date-beginning>MAX_TIME)return void setTimeout(iterate,0)}setTimeout(callBack,0)};setTimeout(iterate,0)}sonantx.AudioGenerator=function(mixBuf){this.mixBuf=mixBuf,this.waveSize=mixBuf.length/WAVE_CHAN/2},sonantx.AudioGenerator.prototype.getWave=function(){var b,k,x,wave,l1,l2,y,mixBuf=this.mixBuf,waveBytes=this.waveSize*WAVE_CHAN*2;for(l2=(l1=waveBytes-8)-36,wave=String.fromCharCode(82,73,70,70,255&l1,l1>>8&255,l1>>16&255,l1>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&l2,l2>>8&255,l2>>16&255,l2>>24&255),b=0;waveBytes>b;){for(x="",k=0;256>k&&waveBytes>b;++k,b+=2)y=-32768>(y=4*(mixBuf[b]+(mixBuf[b+1]<<8)-32768))?-32768:y>32767?32767:y,x+=String.fromCharCode(255&y,y>>8&255);wave+=x}return wave},sonantx.AudioGenerator.prototype.getAudio=function(){var wave=this.getWave(),a=new Audio("data:audio/wav;base64,"+btoa(wave));return a.preload="none",a.load(),a},sonantx.AudioGenerator.prototype.getAudioBuffer=function(callBack){null===audioCtx&&(audioCtx=new AudioContext);var mixBuf=this.mixBuf,waveBytes=this.waveSize*WAVE_CHAN*2,buffer=audioCtx.createBuffer(WAVE_CHAN,this.waveSize,WAVE_SPS),lchan=buffer.getChannelData(0),rchan=buffer.getChannelData(1),b=0,iterate=function(){for(var beginning=new Date,count=0;waveBytes/2>b;){var y=4*(mixBuf[4*b]+(mixBuf[4*b+1]<<8)-32768);if(y=-32768>y?-32768:y>32767?32767:y,lchan[b]=y/32768,y=4*(mixBuf[4*b+2]+(mixBuf[4*b+3]<<8)-32768),y=-32768>y?-32768:y>32767?32767:y,rchan[b]=y/32768,b+=1,(count+=1)%1e3==0&&new Date-beginning>MAX_TIME)return void setTimeout(iterate,0)}setTimeout(function(){callBack(buffer)},0)};setTimeout(iterate,0)},sonantx.SoundGenerator=function(instr,rowLen){this.instr=instr,this.rowLen=rowLen||5605,this.osc_lfo=oscillators[instr.lfo_waveform],this.osc1=oscillators[instr.osc1_waveform],this.osc2=oscillators[instr.osc2_waveform],this.attack=instr.env_attack,this.sustain=instr.env_sustain,this.release=instr.env_release,this.panFreq=Math.pow(2,instr.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,instr.lfo_freq-8)/this.rowLen},sonantx.SoundGenerator.prototype.genSound=function(n,chnBuf,currentpos){new Date;for(var c1=0,c2=0,o1t=getnotefreq(n+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),o2t=getnotefreq(n+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),q=this.instr.fx_resonance/255,low=0,band=0,j=this.attack+this.sustain+this.release-1;j>=0;--j){var k=j+currentpos,lfor=this.osc_lfo(k*this.lfoFreq)*this.instr.lfo_amt/512+.5,e=1;j<this.attack?e=j/this.attack:j<this.attack+this.sustain||(e-=(j-this.attack-this.sustain)/this.release);var t=o1t;this.instr.lfo_osc1_freq&&(t+=lfor),this.instr.osc1_xenv&&(t*=e*e),c1+=t;var rsample=this.osc1(c1)*this.instr.osc1_vol;t=o2t,this.instr.osc2_xenv&&(t*=e*e),c2+=t,rsample+=this.osc2(c2)*this.instr.osc2_vol,this.instr.noise_fader&&(rsample+=(2*Math.random()-1)*this.instr.noise_fader*e),rsample*=e/255;var f=this.instr.fx_freq;this.instr.lfo_fx_freq&&(f*=lfor);var high=q*(rsample-band)-(low+=(f=1.5*Math.sin(3.141592*f/WAVE_SPS))*band);switch(band+=f*high,this.instr.fx_filter){case 1:rsample=high;break;case 2:rsample=low;break;case 3:rsample=band;break;case 4:rsample=low+high}if(t=osc_sin(k*this.panFreq)*this.instr.fx_pan_amt/512+.5,rsample*=39*this.instr.env_master,(k*=4)+3<chnBuf.length){var x=chnBuf[k]+(chnBuf[k+1]<<8)+rsample*(1-t);chnBuf[k]=255&x,chnBuf[k+1]=x>>8&255,x=chnBuf[k+2]+(chnBuf[k+3]<<8)+rsample*t,chnBuf[k+2]=255&x,chnBuf[k+3]=x>>8&255}}},sonantx.SoundGenerator.prototype.getAudioGenerator=function(n,callBack){var bufferSize=this.attack+this.sustain+this.release-1+32*this.rowLen,self=this;genBuffer(bufferSize,function(buffer){self.genSound(n,buffer,0),applyDelay(buffer,bufferSize,self.instr,self.rowLen,function(){callBack(new sonantx.AudioGenerator(buffer))})})},sonantx.SoundGenerator.prototype.createAudio=function(n,callBack){this.getAudioGenerator(n,function(ag){callBack(ag.getAudio())})},sonantx.SoundGenerator.prototype.createAudioBuffer=function(n,callBack){this.getAudioGenerator(n,function(ag){ag.getAudioBuffer(callBack)})},sonantx.MusicGenerator=function(song){this.song=song,this.waveSize=WAVE_SPS*song.songLen},sonantx.MusicGenerator.prototype.generateTrack=function(instr,mixBuf,callBack){var self=this;genBuffer(this.waveSize,function(chnBuf){var waveSamples=self.waveSize,waveBytes=self.waveSize*WAVE_CHAN*2,rowLen=self.song.rowLen,endPattern=self.song.endPattern,soundGen=new sonantx.SoundGenerator(instr,rowLen),currentpos=0,p=0,row=0,recordSounds=function(){for(var beginning=new Date;;)if(32!==row){if(p===endPattern-1)return void setTimeout(delay,0);var cp=instr.p[p];if(cp){var n=instr.c[cp-1].n[row];n&&soundGen.genSound(n,chnBuf,currentpos)}if(currentpos+=rowLen,row+=1,new Date-beginning>MAX_TIME)return void setTimeout(recordSounds,0)}else row=0,p+=1},delay=function(){applyDelay(chnBuf,waveSamples,instr,rowLen,finalize)},b2=0,finalize=function(){for(var beginning=new Date,count=0;waveBytes>b2;){var x2=mixBuf[b2]+(mixBuf[b2+1]<<8)+chnBuf[b2]+(chnBuf[b2+1]<<8)-32768;if(mixBuf[b2]=255&x2,mixBuf[b2+1]=x2>>8&255,b2+=2,(count+=1)%1e3==0&&new Date-beginning>MAX_TIME)return void setTimeout(finalize,0)}setTimeout(callBack,0)};setTimeout(recordSounds,0)})},sonantx.MusicGenerator.prototype.getAudioGenerator=function(callBack){var self=this;genBuffer(this.waveSize,function(mixBuf){var t=0,recu=function(){t<self.song.songData.length?(t+=1,self.generateTrack(self.song.songData[t-1],mixBuf,recu)):callBack(new sonantx.AudioGenerator(mixBuf))};recu()})},sonantx.MusicGenerator.prototype.createAudio=function(callBack){this.getAudioGenerator(function(ag){callBack(ag.getAudio())})},sonantx.MusicGenerator.prototype.createAudioBuffer=function(callBack){this.getAudioGenerator(function(ag){ag.getAudioBuffer(callBack)})};var Stats=function(){function h(a){return c.appendChild(a.dom),a}function k(a){for(var d=0;d<c.children.length;d++)c.children[d].style.display=d===a?"block":"none";l=a}var l=0,c=document.createElement("div");c.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",c.addEventListener("click",function(a){a.preventDefault(),k(++l%c.children.length)},!1);var g=(performance||Date).now(),e=g,a=0,r=h(new Stats.Panel("FPS","#0ff","#002")),f=h(new Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var t=h(new Stats.Panel("MB","#f08","#201"));return k(0),{REVISION:16,dom:c,addPanel:h,showPanel:k,begin:function(){g=(performance||Date).now()},end:function(){a++;var c=(performance||Date).now();if(f.update(c-g,200),c>e+1e3&&(r.update(1e3*a/(c-e),100),e=c,a=0,t)){var d=performance.memory;t.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return c},update:function(){g=this.end()},domElement:c,setMode:k}};Stats.Panel=function(h,k,l){var c=1/0,g=0,e=Math.round,a=e(window.devicePixelRatio||1),r=80*a,f=48*a,t=3*a,u=2*a,d=3*a,m=15*a,n=74*a,p=30*a,q=document.createElement("canvas");q.width=r,q.height=f,q.style.cssText="width:80px;height:48px";var b=q.getContext("2d");return b.font="bold "+9*a+"px Helvetica,Arial,sans-serif",b.textBaseline="top",b.fillStyle=l,b.fillRect(0,0,r,f),b.fillStyle=k,b.fillText(h,t,u),b.fillRect(d,m,n,p),b.fillStyle=l,b.globalAlpha=.9,b.fillRect(d,m,n,p),{dom:q,update:function(f,v){c=Math.min(c,f),g=Math.max(g,f),b.fillStyle=l,b.globalAlpha=1,b.fillRect(0,0,r,m),b.fillStyle=k,b.fillText(e(f)+" "+h+" ("+e(c)+"-"+e(g)+")",t,u),b.drawImage(q,d+a,m,n-a,p,d,m,n-a,p),b.fillRect(d+n-a,m,a,p),b.fillStyle=l,b.globalAlpha=.9,b.fillRect(d+n-a,m,a,e((1-f/v)*p))}}},"object"==typeof module&&(module.exports=Stats),Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,a:65,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown:function(keyCode){return this._pressed[keyCode]},justReleased:function(keyCode){return this._released[keyCode]},onKeydown:function(event){this._pressed[event.keyCode]=!0},onKeyup:function(event){this._released[event.keyCode]=!0,delete this._pressed[event.keyCode]},update:function(){this._released={}}},E.game={create:function(){E.sounds={},window.AudioContext=window.AudioContext||window.webkitAudioContext,audioCtx=new AudioContext,new sonantx.MusicGenerator(E.assets.song).createAudioBuffer(function(buffer){E.sounds.song=buffer}),E.triangles=[];for(var i=0;2e3>i;i++){let ox=255*Math.random()|0,oy=255*Math.random()|0;E.triangles.push({x1:ox+15*Math.random()*2-15,y1:oy+15*Math.random()*2-15,x2:ox+15*Math.random()*2-15,y2:oy+15*Math.random()*2-15,x3:ox+15*Math.random()*2-15,y3:oy+15*Math.random()*2-15,color:31*Math.random()|0})}E.twoColorPalette=[0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],E.inversePalette=E.palDefault.slice().reverse(),E.warmPalette=[14,0,14,3,4,5,6,7,0,1,2,3,4,5,6,7,0,1,2,3,4,5,6,7,0,1,2,3,4,5,6,7],E.bgColor=0,E.fgColor=21,E.t=0,E.moveX=0,E.renderTarget=E.page2,E.gfx.fillRect(0,0,256,256,2),E.gfx.checker(16,16,1),E.player={x:128,y:128,radius:10,xvel:0,yvel:0,speed:6},E.drag=.97,E.songTrigger=!1,E.cursor={x:0,y:0}},resize:function(){E.canvas.width=window.innerWidth,E.canvas.height=window.innerHeight},step:function(dt){E.t+=dt,E.cos=Math.cos(dt),E.sin=Math.sin(dt);for(var i=0;i<E.triangles.length;i++){var tri=E.triangles[i],dx1=tri.x1+-128,dx2=tri.x2+-128,dx3=tri.x3+-128,dy1=tri.y1+-128,dy2=tri.y2+-128,dy3=tri.y3+-128;E.triangles[i].x1=E.cos*dx1-E.sin*dy1+128,E.triangles[i].y1=E.sin*dx1+E.cos*dy1+128,E.triangles[i].x2=E.cos*dx2-E.sin*dy2+128,E.triangles[i].y2=E.sin*dx2+E.cos*dy2+128,E.triangles[i].x3=E.cos*dx3-E.sin*dy3+128,E.triangles[i].y3=E.sin*dx3+E.cos*dy3+128}E.player.x+=dt*E.player.xvel,E.player.y+=dt*E.player.yvel,E.player.xvel*=E.drag,E.player.yvel*=E.drag,Key.isDown(Key.a)&&(E.player.xvel-=E.player.speed),Key.isDown(Key.z)&&(E.songTrigger=!0),E.songTrigger&&(E.songTrigger=!1,E.playSound(E.sounds.song,1,1,1)),Key.isDown(Key.d)&&(E.player.xvel+=E.player.speed),Key.isDown(Key.w)&&(E.player.yvel-=E.player.speed),Key.isDown(Key.s)&&(E.player.yvel+=E.player.speed),E.player.x>256+2*E.player.radius&&(E.player.x=-E.player.radius),E.player.x<0-2*E.player.radius&&(E.player.x=256+E.player.radius),E.player.y>256+2*E.player.radius&&(E.player.y=-E.player.radius),E.player.y<0-2*E.player.radius&&(E.player.y=256+E.player.radius)},render:function(dt){E.renderTarget=E.page1,E.gfx.fillRect(0,0,256,256,0);for(var i=0;i<E.triangles.length;i++)E.gfx.fillTriangle(E.triangles[i].x1,E.triangles[i].y1,E.triangles[i].x2,E.triangles[i].y2,E.triangles[i].x3,E.triangles[i].y3,E.triangles[i].color);E.gfx.circle(E.player.x,E.player.y,E.player.radius,21),E.renderSource=E.page2,E.renderTarget=E.page4,E.gfx.spr(0,0,256,256,0,0),E.renderSource=E.page1,E.gfx.spr(0,0,256,256,0,0),E.renderSource=E.page4,E.renderTarget=E.screen,E.gfx.spr(0,0,256,256),E.pal=E.warmPalette,E.moveX=64*Math.sin(E.t)|0,E.gfx.spr(64,64,128,128,64,64),E.pal=E.twoColorPalette,E.gfx.spr(0,0,64,64),E.gfx.spr(0,192,64,256,0,192),E.gfx.spr(192,192,256,256,192,192),E.gfx.spr(191,0,256,64,191,0),E.pal=E.palDefault,E.render()}},function(){var E=ENGINE;E.last=0,E.dt=0,E.now=0,stats=new Stats,document.body.appendChild(stats.dom),E.canvasInit(),E.game.create(),window.addEventListener("keyup",function(event){Key.onKeyup(event)},!1),window.addEventListener("keydown",function(event){Key.onKeydown(event)},!1),window.addEventListener("blur",function(event){paused=!0},!1),window.addEventListener("focus",function(event){paused=!1},!1),window.addEventListener("resize",E.game.resize);function loop(){stats.begin();let now=(new Date).getTime();E.dt=Math.min(1,(now-E.last)/1e3),E.game.step(E.dt),E.last=now,E.game.render(),stats.end(),requestAnimationFrame(loop)}loop()}();
</script></body></html>